<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מסלול גורל החטופים - תרשים זרימה</title>
    
    <!-- D3.js and d3-sankey -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    
    <!-- Fallback script loader -->
    <script>
        // Check if d3-sankey loaded properly, if not try alternative CDN
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof d3 === 'undefined' || typeof d3.sankey === 'undefined') {
                    console.warn('Primary d3-sankey CDN failed, trying fallback...');
                    
                    // Create fallback script element
                    const script = document.createElement('script');
                    script.src = 'https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js';
                    script.onload = function() {
                        console.log('Fallback d3-sankey loaded');
                        if (window.hostageApp && window.hostageApp.init) {
                            window.hostageApp.init();
                        }
                    };
                    script.onerror = function() {
                        console.error('Both primary and fallback d3-sankey CDNs failed');
                    };
                    document.head.appendChild(script);
                }
            }, 50);
        });
    </script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>מסלול גורל החטופים - תרשים זרימה</h1>
            <div class="header-stats">
                <span id="total-hostages">240+ חטופים</span>
                <span id="data-updated">עדכון אחרון: אוגוסט 2024</span>
                <span class="interaction-hint">לחץ על זרימה לראות נתיבים פרטיים</span>
            </div>
        </header>
        
        <main class="main-content">
            <div class="sankey-container">
                <svg id="sankey-chart"></svg>
            </div>
            
            <div class="legend-container">
                <div class="step-legend">
                    <div class="step-group">
                        <h3>מצב ב-7 באוקטובר</h3>
                        <div class="legend-items">
                            <div class="legend-item">
                                <div class="legend-color alive-oct7"></div>
                                <span>חיים ב-7.10</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color deceased-oct7"></div>
                                <span>נפטרו ב-7.10</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-group">
                        <h3>תוצאה סופית (מקובצת לפי אמצעי)</h3>
                        <div class="legend-group">
                            <h4>3 קבוצות תוצאות עיקריות</h4>
                            <p>כל קבוצה מחולקת פנימית לחיים (למעלה) ונפטרו (למטה)</p>
                            
                            <div class="legend-subgroup">
                                <h5>שוחררו בעסקה</h5>
                                <div class="legend-subdivision-box">
                                    <div class="legend-subdivision living">חיים</div>
                                    <div class="legend-subdivision deceased">נפטרו</div>
                                </div>
                            </div>
                            
                            <div class="legend-subgroup">
                                <h5>חולצו במבצע</h5>
                                <div class="legend-subdivision-box">
                                    <div class="legend-subdivision living">חיים</div>
                                    <div class="legend-subdivision deceased">נפטרו</div>
                                </div>
                            </div>
                            
                            <div class="legend-subgroup">
                                <h5>עדיין בשבי</h5>
                                <div class="legend-subdivision-box">
                                    <div class="legend-subdivision living">חיים</div>
                                    <div class="legend-subdivision deceased">נפטרו</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Tooltip -->
        <div id="tooltip" class="tooltip hidden">
            <div class="tooltip-content"></div>
        </div>
    </div>

    <!-- JavaScript modules -->
    <script src="js/sankey-basic.js?v=20250831-17"></script>
    <script src="js/data-processor.js?v=20250831-17"></script>
    <script src="js/sankey-rtl.js?v=20250831-17"></script>
    <script src="js/interaction.js?v=20250831-17"></script>
    <script src="js/main.js?v=20250831-17"></script>
</body>
</html>