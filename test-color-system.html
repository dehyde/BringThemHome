<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color System Test</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .color-preview { width: 100px; height: 30px; margin: 5px; display: inline-block; border: 1px solid #000; }
        .gradient-preview { width: 200px; height: 30px; margin: 5px; display: inline-block; border: 1px solid #000; }
    </style>
</head>
<body>
    <h1>Color System Test</h1>
    
    <div class="test-section">
        <h2>Base Colors</h2>
        <div id="base-colors"></div>
    </div>
    
    <div class="test-section">
        <h2>Gradient Tests</h2>
        <div id="gradient-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>Hostage State Tests</h2>
        <div id="hostage-tests"></div>
    </div>

    <script src="js/color-manager.js"></script>
    <script>
        // Mock timeline core for testing
        class MockTimelineCore {
            constructor() {
                this.svg = d3.select('body').append('svg').attr('width', 800).attr('height', 600);
            }
        }
        
        // Initialize color manager
        const timelineCore = new MockTimelineCore();
        const colorManager = new ColorManager(timelineCore);
        
        // Test base colors
        const baseColors = colorManager.config.baseColors;
        const baseColorsDiv = d3.select('#base-colors');
        
        Object.entries(baseColors).forEach(([name, color]) => {
            baseColorsDiv.append('div')
                .style('display', 'inline-block')
                .style('margin', '5px')
                .html(`<div class="color-preview" style="background-color: ${color}"></div><br><small>${name}</small>`);
        });
        
        // Test gradients
        const gradientTests = [
            { id: 'living-to-death', name: 'Living to Death' },
            { id: 'living-to-deceased', name: 'Living to Deceased' },
            { id: 'living-to-released-deal', name: 'Living to Released (Deal)' },
            { id: 'living-to-released-military', name: 'Living to Released (Military)' }
        ];
        
        const gradientDiv = d3.select('#gradient-tests');
        gradientTests.forEach(gradient => {
            gradientDiv.append('div')
                .style('display', 'inline-block')
                .style('margin', '5px')
                .html(`<div class="gradient-preview" style="background: url(#${gradient.id})"></div><br><small>${gradient.name}</small>`);
        });
        
        // Test hostage configurations
        const testHostages = [
            {
                name: 'Living in Captivity',
                hostage: {
                    'Hebrew Name': 'Test Living',
                    'Current Status': 'Held in Gaza',
                    path: [{ lane: 'kidnapped-living', date: new Date('2023-10-07') }]
                }
            },
            {
                name: 'Deceased - Was Living',
                hostage: {
                    'Hebrew Name': 'Test Deceased Living',
                    'Current Status': 'Deceased - Returned',
                    path: [
                        { lane: 'kidnapped-living', date: new Date('2023-10-07') },
                        { lane: 'kidnapped-deceased', date: new Date('2023-11-15') }
                    ]
                }
            },
            {
                name: 'Released via Deal',
                hostage: {
                    'Hebrew Name': 'Test Released Deal',
                    'Current Status': 'Released',
                    'Release/Death Circumstances': 'Released via Deal',
                    path: [
                        { lane: 'kidnapped-living', date: new Date('2023-10-07') },
                        { lane: 'released-deal-living', date: new Date('2023-11-24') }
                    ]
                }
            },
            {
                name: 'Released via Military',
                hostage: {
                    'Hebrew Name': 'Test Released Military',
                    'Current Status': 'Released',
                    'Release/Death Circumstances': 'Returned in Military Operation',
                    path: [
                        { lane: 'kidnapped-living', date: new Date('2023-10-07') },
                        { lane: 'released-military-living', date: new Date('2024-06-08') }
                    ]
                }
            }
        ];
        
        const hostageDiv = d3.select('#hostage-tests');
        testHostages.forEach(test => {
            const colorConfig = colorManager.getHostageColorConfig(test.hostage);
            const colorDisplay = colorConfig.type === 'gradient' ? 
                `url(#${colorConfig.gradientId})` : colorConfig.color;
            
            hostageDiv.append('div')
                .style('display', 'inline-block')
                .style('margin', '5px')
                .style('padding', '10px')
                .style('border', '1px solid #ddd')
                .html(`
                    <div class="color-preview" style="background: ${colorDisplay}; opacity: ${colorConfig.opacity}"></div>
                    <br><strong>${test.name}</strong><br>
                    <small>Type: ${colorConfig.type}</small><br>
                    <small>Opacity: ${colorConfig.opacity}</small>
                `);
        });
        
        console.log('Color system test completed successfully!');
    </script>
</body>
</html>
